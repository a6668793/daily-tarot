<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE NARRATOR · 極簡靈魂映畫</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Noto+Serif+TC:wght@300;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #FAFAFA;
            --surface-color: #FFFFFF;
            --text-main: #2C2C2C;
            --text-light: #959595;
            --accent: #D4AF37;
            --card-w: 300px;
            --card-h: 520px;
        }

        body {
            font-family: 'Lato', 'Noto Serif TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow-x: hidden;
        }

        .gallery-wrapper {
            width: 100%;
            max-width: 900px;
            background: var(--surface-color);
            box-shadow: 0 30px 60px rgba(0,0,0,0.05); 
            padding: 5rem 2rem;
            margin: 2rem;
            position: relative;
        }

        /* --- Header --- */
        header { text-align: center; margin-bottom: 5rem; position: relative; }
        header::after {
            content: ''; display: block; width: 40px; height: 1px; 
            background: #ddd; margin: 30px auto 0;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 500;
            letter-spacing: 0.05em;
            margin: 0;
            color: #111;
        }
        .subtitle {
            font-size: 0.8rem;
            color: var(--text-light);
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-top: 15px;
        }

        /* --- 輸入表單區 --- */
        .form-container {
            max-width: 600px;
            margin: 0 auto 4rem auto;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            align-items: end;
        }

        .input-group { position: relative; }
        
        .label-float {
            display: block;
            font-size: 0.65rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin-bottom: 8px;
            text-align: center;
        }

        input, select {
            width: 100%;
            border: none;
            border-bottom: 1px solid #e0e0e0;
            padding: 10px 0;
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            background: transparent;
            outline: none;
            color: var(--text-main);
            border-radius: 0;
            text-align: center;
            text-align-last: center;
            transition: border-color 0.3s;
        }
        input:focus, select:focus { border-bottom-color: var(--text-main); }
        input::placeholder { font-family: 'Lato'; font-size: 0.9rem; letter-spacing: 0.1em; color: #ddd; }

        /* --- 水晶選擇區 --- */
        .crystal-section {
            text-align: center;
            margin-bottom: 5rem;
        }

        .crystal-deck {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
            min-height: 70px;
        }

        .gem {
            width: 65px; height: 65px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1), inset 2px 2px 8px rgba(255,255,255,0.6);
            border: 1px solid rgba(0,0,0,0.03);
            opacity: 0;
            animation: fadeInGem 0.8s forwards;
        }
        
        @keyframes fadeInGem { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .gem:hover { transform: translateY(-5px) scale(1.1); }
        .gem.selected { 
            transform: scale(1.15); 
            box-shadow: 0 0 0 5px var(--surface-color), 0 0 0 6px var(--text-main), 0 15px 30px rgba(0,0,0,0.15);
        }
        
        /* 真實水晶紋理 CSS */
        .gem-clear { background: radial-gradient(circle at 30% 30%, #fff, #f4f4f4, #e0e0e0); }
        .gem-amethyst { background: radial-gradient(circle at 30% 30%, #e6ccff, #9b59b6, #4a235a); }
        .gem-rose { background: radial-gradient(circle at 40% 40%, #fff5f5, #ffccd5, #e099a8); }
        .gem-obsidian { background: radial-gradient(circle at 35% 35%, #555, #111, #000); }
        .gem-citrine { background: radial-gradient(circle at 30% 30%, #fffbe6, #f7dc6f, #b7950b); }
        .gem-moon { background: radial-gradient(circle at 50% 50%, #fff, #e6e6fa, #c2c2d6); box-shadow: inset 0 0 15px rgba(100,149,237,0.2); }
        .gem-tiger { background: linear-gradient(135deg, #3e2723, #8d6e63, #ffb74d, #5d4037); background-size: 200% 200%; }
        .gem-aqua { background: radial-gradient(circle at 30% 30%, #e0ffff, #7fffd4, #20b2aa); }
        .gem-lapis { background: radial-gradient(circle at 30% 30%, #6495ed, #000080, #191970); }
        .gem-jade { background: radial-gradient(circle at 30% 30%, #98fb98, #3cb371, #2e8b57); }
        .gem-ruby { background: radial-gradient(circle at 30% 30%, #ffcccc, #e74c3c, #922b21); }
        .gem-sapphire { background: radial-gradient(circle at 30% 30%, #ccd1ff, #2980b9, #154360); }
        .gem-opal { background: conic-gradient(from 45deg, #ff9a9e, #fad0c4, #fad0c4, #a18cd1, #ff9a9e); filter: blur(0.5px); }
        .gem-garnet { background: radial-gradient(circle at 30% 30%, #e6b0aa, #c0392b, #641e16); }
        .gem-turquoise { background: radial-gradient(circle at 30% 30%, #afeeee, #48c9b0, #117864); }

        .gem-info {
            height: 20px;
            font-family: 'Playfair Display', serif;
            font-style: italic;
            color: var(--text-main);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .btn-refresh {
            font-size: 0.7rem;
            color: #ccc;
            cursor: pointer;
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: 0.3s;
        }
        .btn-refresh:hover { color: #999; border-bottom: 1px solid #999; }

        .btn-main {
            display: block;
            margin: 0 auto;
            padding: 18px 70px;
            background: transparent;
            border: 1px solid var(--text-main);
            color: var(--text-main);
            font-family: 'Lato';
            text-transform: uppercase;
            letter-spacing: 0.25em;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.4s ease;
        }
        .btn-main:hover { background: var(--text-main); color: #fff; }

        /* --- 結果區 --- */
        #result-view { display: none; flex-direction: column; align-items: center; width: 100%; }

        .music-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 4rem;
            opacity: 0.6;
        }
        .music-anim { width: 40px; height: 1px; background: #333; animation: pulse 1s infinite alternate; }
        @keyframes pulse { from { width: 10px; } to { width: 40px; } }

        .card-frame {
            width: var(--card-w);
            height: var(--card-h);
            perspective: 1500px;
            cursor: pointer;
            margin-bottom: 5rem;
            position: relative;
        }
        
        .card-inner {
            width: 100%; height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            transition: transform 1.2s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: 0 40px 80px rgba(0,0,0,0.1);
        }
        .card-inner.flipped { transform: rotateY(180deg); }

        .face {
            position: absolute;
            width: 100%; height: 100%;
            backface-visibility: hidden;
            background: #fff;
            overflow: hidden;
        }
        
        .back {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #fff;
            border: 1px solid #f2f2f2;
        }
        .back::after {
            content: "THE NARRATOR";
            writing-mode: vertical-rl;
            letter-spacing: 0.5em;
            font-family: 'Lato';
            font-size: 0.8rem;
            color: #ddd;
        }

        .front { transform: rotateY(180deg); }
        .ai-image {
            width: 100%; height: 100%;
            object-fit: cover;
            opacity: 0; 
            transition: opacity 1s ease;
        }
        .loading-msg {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-family: 'Playfair Display';
            font-style: italic;
            color: #aaa;
            width: 80%;
            font-size: 0.9rem;
        }

        /* 閱讀區 - 修改為置中垂直排列 */
        .reading-section {
            width: 100%; max-width: 600px;
            opacity: 0; transform: translateY(40px);
            transition: all 1s 0.8s;
            text-align: center; /* 整體置中 */
        }
        .reading-section.visible { opacity: 1; transform: translateY(0); }

        .card-header { text-align: center; margin-bottom: 4rem; }
        .title-en { font-family: 'Playfair Display'; font-size: 2.5rem; color: #111; margin-bottom: 10px; }
        .title-ch { font-family: 'Noto Serif TC'; font-size: 1rem; color: #999; letter-spacing: 0.15em; }

        /* 垂直排列容器 */
        .vertical-layout {
            display: flex;
            flex-direction: column;
            gap: 40px; /* 區塊間距 */
            border-top: 1px solid #f0f0f0;
            padding-top: 40px;
            align-items: center; /* 子元素水平置中 */
        }
        .grid-item { 
            margin-bottom: 10px; 
            max-width: 500px; /* 限制文字寬度以利閱讀 */
        }
        .g-label { 
            font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.3em; 
            color: var(--accent); display: block; margin-bottom: 15px; font-weight: 600;
        }
        .g-text { 
            font-size: 1.05rem; line-height: 1.9; color: #444; 
            font-family: 'Noto Serif TC';
        }

        @media (max-width: 768px) {
            .form-container { grid-template-columns: 1fr; gap: 20px; }
            h1 { font-size: 2.2rem; }
        }
    </style>
</head>
<body>

    <div class="gallery-wrapper">
        <header>
            <h1>THE NARRATOR</h1>
            <div class="subtitle">Minimalist Soul & Light Music</div>
        </header>

        <div id="setup-panel">
            
            <div class="form-container">
                <div class="input-group">
                    <span class="label-float">Name / 姓名</span>
                    <input type="text" id="username" placeholder="Enter Name">
                </div>
                <div class="input-group">
                    <span class="label-float">Number / 靈魂數字</span>
                    <input type="number" id="userNum" placeholder="1-99" min="1" max="99">
                </div>
                <div class="input-group">
                    <span class="label-float">Zodiac / 星座</span>
                    <select id="zodiac">
                        <option value="" disabled selected>Select...</option>
                        <option value="Aries">牡羊座 Aries</option>
                        <option value="Taurus">金牛座 Taurus</option>
                        <option value="Gemini">雙子座 Gemini</option>
                        <option value="Cancer">巨蟹座 Cancer</option>
                        <option value="Leo">獅子座 Leo</option>
                        <option value="Virgo">處女座 Virgo</option>
                        <option value="Libra">天秤座 Libra</option>
                        <option value="Scorpio">天蠍座 Scorpio</option>
                        <option value="Sagittarius">射手座 Sagittarius</option>
                        <option value="Capricorn">摩羯座 Capricorn</option>
                        <option value="Aquarius">水瓶座 Aquarius</option>
                        <option value="Pisces">雙魚座 Pisces</option>
                    </select>
                </div>
            </div>

            <div class="crystal-section">
                <span class="label-float" style="margin-bottom: 20px; display:block;">Select Your Soul Stone / 選擇靈魂水晶</span>
                <div class="crystal-deck" id="gem-deck">
                    </div>
                <div class="gem-info" id="gem-label">Please choose one...</div>
                <div class="btn-refresh" onclick="generateRandomCrystals()">↻ Refresh Stones</div>
            </div>

            <button class="btn-main" onclick="revealDestiny()">Reveal Destiny</button>
        </div>

        <div id="result-view">
            
            <div class="music-bar">
                <div class="music-anim"></div>
                <span id="music-info" style="font-size: 0.8rem; font-family: 'Lato';">Loading Light Music...</span>
                <audio id="audio-player" loop crossorigin="anonymous" preload="auto"></audio>
            </div>

            <div class="card-frame" onclick="flipCard()">
                <div class="card-inner" id="card-obj">
                    <div class="face front">
                        <div class="loading-msg" id="loader">
                            Generating minimalist art<br>based on your energy...
                        </div>
                        <img id="ai-art" class="ai-image" alt="Soul Art">
                    </div>
                    <div class="face back"></div>
                </div>
            </div>

            <div class="reading-section" id="reading-content">
                <div class="card-header">
                    <div class="title-en" id="res-en">The Empress</div>
                    <div class="title-ch" id="res-ch">皇后 · 豐盛</div>
                </div>

                <div class="vertical-layout">
                    <div class="grid-item">
                        <span class="g-label">Fortune / 運勢</span>
                        <div class="g-text" id="txt-fortune"></div>
                    </div>
                    <div class="grid-item">
                        <span class="g-label">Work / 事業</span>
                        <div class="g-text" id="txt-work"></div>
                    </div>
                    <div class="grid-item" style="border-top: 1px dotted #eee; padding-top: 30px;">
                        <span class="g-label" style="color: var(--text-main); font-size: 0.8rem;">Your Soul Energy Today / 今日靈魂能量</span>
                        <div class="g-text" id="txt-energy" style="font-size: 1.15rem; font-weight: 500;"></div>
                    </div>
                    <div class="grid-item" style="border-top: 1px dotted #eee; padding-top: 30px;">
                        <span class="g-label">Love / 愛情</span>
                        <div class="g-text" id="txt-love"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. 資料庫設定
        // ==========================================
        
        // 水晶資料 (加入 energyText 用於解讀)
        const allCrystals = [
            { name: "Clear Quartz 白水晶", class: "gem-clear", prompt: "minimalist white abstract art, clean lines, translucent, ethereal light, pure", energyText: "淨化與清晰的能量，幫助你排除雜念，看清事物的本質。" },
            { name: "Amethyst 紫水晶", class: "gem-amethyst", prompt: "minimalist purple abstract art, soft gradient, mysterious, spiritual, calm", energyText: "直覺與智慧的能量，引導你連結內在的聲音，保持平靜。" },
            { name: "Rose Quartz 粉晶", class: "gem-rose", prompt: "minimalist soft pink abstract art, gentle curves, romantic, dreamy, warmth", energyText: "溫柔與愛的能量，提醒你先愛自己，再將這份溫暖分享給他人。" },
            { name: "Obsidian 黑曜石", class: "gem-obsidian", prompt: "minimalist black and grey abstract art, high contrast geometric, powerful, deep, grounding", energyText: "守護與落實的能量，協助你抵擋負面影響，腳踏實地完成目標。" },
            { name: "Citrine 黃水晶", class: "gem-citrine", prompt: "minimalist golden yellow abstract art, sun rays, bright, joyful, abundance", energyText: "自信與豐盛的能量，激發你的創造力，吸引美好的事物來到身邊。" },
            { name: "Moonstone 月光石", class: "gem-moon", prompt: "minimalist iridescent white and blue abstract art, soft glow, magical, serene", energyText: "溫柔與直覺的能量，如同月光般照亮潛意識，帶來內心的寧靜。" },
            { name: "Aquamarine 海藍寶", class: "gem-aqua", prompt: "minimalist pale blue abstract art, flowing lines like water, calm, refreshing, clear", energyText: "溝通與流動的能量，幫助你順暢地表達真實的想法，像水一樣靈活。" },
            { name: "Lapis Lazuli 青金石", class: "gem-lapis", prompt: "minimalist deep royal blue abstract art, gold specks, ancient wisdom, starry", energyText: "洞察與真理的能量，提升你的覺知，做出最符合靈魂藍圖的決定。" },
            { name: "Ruby 紅寶石", class: "gem-ruby", prompt: "minimalist deep red abstract art, bold strokes, passion, vitality, warmth", energyText: "熱情與活力的能量，點燃你對生活的渴望，勇敢追求所愛。" },
            { name: "Jade 東菱玉", class: "gem-jade", prompt: "minimalist soft green abstract art, organic shapes, healing, growth, nature", energyText: "和諧與生長的能量，帶來身心的平衡，如同植物般穩定向上發展。" }
        ];

        // 靈魂數字簡易解讀 (用於組合正能量文案)
        const numberMeanings = {
            1: "象徵新的開始與領導力，今天是採取行動的好時機。",
            2: "代表平衡與合作，適合與人連結，在關係中找到和諧。",
            3: "充滿創造力與表達欲，請大膽展現你的獨特想法。",
            4: "強調穩定與秩序，按部就班能為你帶來安全感。",
            5: "擁抱變化與自由，嘗試一點新鮮事物會帶來驚喜。",
            6: "關乎愛與責任，照顧好自己與身邊的人。",
            7: "適合內省與思考，花點時間與自己獨處對話。",
            8: "專注於目標與顯化，你的努力將會看見成果。",
            9: "代表智慧與完成，放下不再需要的，準備迎接下個階段。"
        };

        let selectedGem = null;

        function generateRandomCrystals() {
            const shuffled = [...allCrystals].sort(() => 0.5 - Math.random());
            const picked = shuffled.slice(0, 5);
            const container = document.getElementById('gem-deck');
            container.innerHTML = ''; 
            selectedGem = null;
            document.getElementById('gem-label').innerText = "Please choose one...";
            document.getElementById('gem-label').style.opacity = "0.5";

            picked.forEach((g, idx) => {
                const el = document.createElement('div');
                el.className = `gem ${g.class}`;
                el.style.animationDelay = `${idx * 0.1}s`; 
                el.onclick = () => {
                    document.querySelectorAll('.gem').forEach(x => x.classList.remove('selected'));
                    el.classList.add('selected');
                    selectedGem = g;
                    const label = document.getElementById('gem-label');
                    label.innerText = g.name;
                    label.style.opacity = "1";
                };
                container.appendChild(el);
            });
        }
        window.onload = generateRandomCrystals;

        // ==========================================
        // 2. 輕音樂播放列表 (Piano/Violin Light Music)
        // ==========================================
        // 使用較小的檔案並預載以加快速度
        const lightMusicPlaylist = [
            { name: "Gentle Piano Flow", url: "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Kai_Engel/Chapter_One_-_Cold/Kai_Engel_-_04_-_Moonlight_Reprise.mp3" },
            { name: "Soft Violin & Piano", url: "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/ccCommunity/Kai_Engel/Satin/Kai_Engel_-_03_-_Contention.mp3" },
            { name: "Minimalist Piano", url: "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/ccCommunity/Chad_Crouch/Arps/Chad_Crouch_-_01_-_Algorithms.mp3" },
            { name: "Ethereal Strings", url: "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/Music_for_Video/Rafael_Archangel/Found/Rafael_Archangel_-_05_-_Found.mp3" }
        ];

        // ==========================================
        // 3. 塔羅與文案資料
        // ==========================================
        const deck = [
            { en: "The Fool", ch: "愚者", prompt: "minimalist abstract art, figure stepping off cliff, white rose, sun, clean lines, conceptual" },
            { en: "The Magician", ch: "魔術師", prompt: "minimalist abstract art, geometric shapes representing elements, infinity symbol, creative force" },
            { en: "The High Priestess", ch: "女祭司", prompt: "minimalist abstract art, veil, moon crescent, two pillars, deep wisdom, serene composition" },
            { en: "The Empress", ch: "皇后", prompt: "minimalist abstract art, flowing organic shapes, nature, crown of stars, abundance, gentle curves" },
            { en: "The Emperor", ch: "皇帝", prompt: "minimalist abstract art, strong geometric block structure, throne representation, authority, stability" },
            { en: "The Lovers", ch: "戀人", prompt: "minimalist abstract art, two intertwining figures, connection, harmony, light, conceptual romance" },
            { en: "The Hermit", ch: "隱士", prompt: "minimalist abstract art, single light source in darkness, solitary figure outline, introspection, wisdom" },
            { en: "The Star", ch: "星星", prompt: "minimalist abstract art, large star shape pouring light, hope, calm waters, serene blue and white" },
            { en: "The Moon", ch: "月亮", prompt: "minimalist abstract art, moon shapes, illusion, path between towers, mysterious, soft blur" },
            { en: "The Sun", ch: "太陽", prompt: "minimalist abstract art, radiant sun circle, bright, warm colors, joy, simple positive shapes" },
            { en: "Death", ch: "死神", prompt: "minimalist abstract art, abstract transition, end and beginning, white rose silhouette, transformation" },
            { en: "The World", ch: "世界", prompt: "minimalist abstract art, complete circle, harmony of elements, fulfillment, wholeness conceptual" }
        ];

        const fortunes = {
            general: ["相信直覺，新的旅程即將展開。", "現在是採取行動的最佳時刻。", "保持耐心，一切都在正確的軌道上。", "意外的好消息將在近期出現。"],
            work: ["專業能力受到肯定，適合提案。", "專注於長遠目標，勿短視近利。", "合作運佳，多與團隊溝通。", "創意靈感湧現，打破舊有框架。"],
            love: ["敞開心扉，真誠的連結正在靠近。", "放下過去的包袱，迎接新生。", "溝通能化解誤會，增進感情。", "享受當下的甜蜜與平靜。"]
        };

        // ==========================================
        // 4. 核心互動
        // ==========================================
        let currentCard = null;
        let selectedTrack = null;

        function revealDestiny() {
            const name = document.getElementById('username').value;
            const numStr = document.getElementById('userNum').value;
            const zodiac = document.getElementById('zodiac').value;

            if(!name || !numStr || !zodiac || !selectedGem) {
                alert("Please fill in all fields and select a Soul Stone.\n請填寫所有欄位並選擇一顆水晶。");
                return;
            }
            const num = parseInt(numStr);

            // 1. UI 轉場
            document.getElementById('setup-panel').style.display = 'none';
            document.getElementById('result-view').style.display = 'flex';

            // 2. 快速啟動音樂 (立即播放)
            selectedTrack = lightMusicPlaylist[Math.floor(Math.random() * lightMusicPlaylist.length)];
            const audio = document.getElementById('audio-player');
            audio.src = selectedTrack.url;
            audio.volume = 0.5;
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => { console.log("Auto-play blocked, click card to play."); });
            }
            document.getElementById('music-info').innerText = `Now Playing: ${selectedTrack.name}`;

            // 3. 抽牌
            const randIdx = Math.floor(Math.random() * deck.length);
            currentCard = deck[randIdx];

            // 4. AI 繪圖 (極簡風格 + 快速設定)
            const seed = Math.floor(Math.random() * 99999);
            // 使用較小的尺寸 (350x600) 以加快生成與傳輸速度
            // 提示詞強調 "minimalist, abstract design"
            const prompt = `minimalist abstract design art, ${currentCard.prompt}, ${selectedGem.prompt}, clean style, conceptual, high quality, --seed ${seed}`;
            const encoded = encodeURIComponent(prompt);
            const aiUrl = `https://image.pollinations.ai/prompt/${encoded}?width=350&height=600&nologo=true`;

            const imgEl = document.getElementById('ai-art');
            const loader = document.getElementById('loader');
            imgEl.src = aiUrl;
            imgEl.onload = () => {
                loader.style.display = 'none';
                imgEl.style.opacity = '1';
            };

            // 5. 填寫內容
            document.getElementById('res-en').innerText = currentCard.en;
            document.getElementById('res-ch').innerText = `${currentCard.ch} · ${zodiac}`;
            
            document.getElementById('txt-fortune').innerText = fortunes.general[Math.floor(Math.random() * fortunes.general.length)];
            document.getElementById('txt-work').innerText = fortunes.work[Math.floor(Math.random() * fortunes.work.length)];
            
            // --- 核心修改：客製化正能量解讀 (水晶 + 數字) ---
            // 計算數字總和的個位數 (例如 12 -> 3)
            let soulDigit = num;
            while (soulDigit > 9) {
                soulDigit = String(soulDigit).split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
            }
            const numMsg = numberMeanings[soulDigit] || "擁有無限的潛能。";
            // 組合文案
            const combinedEnergyMsg = `今日你的靈魂數字「${num}」${numMsg}同時，你選擇了「${selectedGem.name.split(' ')[1]}」，它帶來${selectedGem.energyText}這股美好的共振將支持你以最正向的頻率度過今天。`;
            
            document.getElementById('txt-energy').innerText = combinedEnergyMsg;
            // -------------------------------------------

            document.getElementById('txt-love').innerText = fortunes.general[Math.floor(Math.random() * fortunes.general.length)];
        }

        function flipCard() {
            const cardObj = document.getElementById('card-obj');
            if(cardObj.classList.contains('flipped')) return;

            cardObj.classList.add('flipped');
            document.getElementById('reading-content').classList.add('visible');
            
            const audio = document.getElementById('audio-player');
            if(audio.paused) audio.play();
        }
    </script>
</body>
</html>
